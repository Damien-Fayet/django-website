{% extends "avent2025/modern_base.html" %}
{% load static %}

{% block title %}Accueil - Calendrier de l'Avent 2025{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'avent2025/css/modern-home.css' %}">
{% endblock %}

{% block content %}

{% if user.is_authenticated %}

<!-- Hero Section -->
<section class="hero-section fade-in">
    <h1>ğŸ„ Calendrier de l'Avent 2025</h1>
    <p>Bienvenue {{ user.username }} ! PrÃªt Ã  relever les dÃ©fis de cette nouvelle Ã©dition ?</p>
    
    <!-- Compte Ã  rebours jusqu'au 1er dÃ©cembre -->
    <div id="countdown-container" style="display: none;">
        <div class="countdown-wrapper">
            <div class="countdown-sparkle">âœ¨</div>
            <div class="countdown-title-modern">
                <span class="countdown-emoji">ğŸ„</span>
                <span>Ouverture du calendrier dans</span>
                <span class="countdown-emoji">ğŸ„</span>
            </div>
            <div class="countdown-grid">
                <div class="countdown-card">
                    <div class="countdown-flip">
                        <div class="countdown-number" id="days">00</div>
                    </div>
                    <div class="countdown-label-modern">Jours</div>
                </div>
                <div class="countdown-card">
                    <div class="countdown-flip">
                        <div class="countdown-number" id="hours">00</div>
                    </div>
                    <div class="countdown-label-modern">Heures</div>
                </div>
                <div class="countdown-card">
                    <div class="countdown-flip">
                        <div class="countdown-number" id="minutes">00</div>
                    </div>
                    <div class="countdown-label-modern">Minutes</div>
                </div>
                <div class="countdown-card">
                    <div class="countdown-flip">
                        <div class="countdown-number" id="seconds">00</div>
                    </div>
                    <div class="countdown-label-modern">Secondes</div>
                </div>
            </div>
            <div class="countdown-date-info">
                <span class="countdown-icon">ğŸ</span>
                Rendez-vous le <strong>1er dÃ©cembre 2025</strong> Ã  <strong>00h01</strong>
                <span class="countdown-icon">ğŸ</span>
            </div>
        </div>
    </div>
    
    <!-- Stats compactes dans le hero -->
    <div class="hero-stats">
        <div class="hero-stat">
            <span class="hero-stat-icon">ğŸ§©</span>
            <span class="hero-stat-value">
                {% if user.userprofile_2025.currentEnigma == 0 %}0{% else %}{{ user.userprofile_2025.currentEnigma|add:"-1" }}{% endif %}/8
            </span>
            <span class="hero-stat-label">rÃ©solues</span>
        </div>
        <div class="hero-stat">
            <span class="hero-stat-icon">ğŸ­</span>
            <span class="hero-stat-value">
                {% if user.userprofile_2025.currentDevinette == 0 %}0{% else %}{{ user.userprofile_2025.currentDevinette|add:"-1" }}{% endif %}/24
            </span>
            <span class="hero-stat-label">devinettes</span>
        </div>
        <div class="hero-stat">
            <span class="hero-stat-icon">âŒ</span>
            <span class="hero-stat-value">{{ user.userprofile_2025.erreurEnigma }}</span>
            <span class="hero-stat-label">erreurs</span>
        </div>
        <div class="hero-stat hero-stat-highlight">
            <span class="hero-stat-icon">â­</span>
            <span class="hero-stat-value">{{ user.userprofile_2025.score }}</span>
            <span class="hero-stat-label">points</span>
        </div>
    </div>
    
    <div class="hero-cta">
        {% if user.userprofile_2025.currentEnigma == 0 %}
            <a href="{% url 'avent2025:start_adventure' %}" class="hero-btn hero-btn-primary">
                ğŸš€ Commencer l'aventure
            </a>
        {% else %}
            <a href="{% url 'avent2025:display_enigme' %}" class="hero-btn hero-btn-primary">
                â–¶ï¸ Continuer l'Ã©nigme {{ user.userprofile_2025.currentEnigma }}
            </a>
        {% endif %}
        
        {% if user.userprofile_2025.currentDevinette == 0 %}
            <a href="{% url 'avent2025:start_devinette' %}" class="hero-btn hero-btn-primary">
                ğŸ­ Commencer les devinettes
            </a>
        {% else %}
            <a href="{% url 'avent2025:display_devinette' %}" class="hero-btn hero-btn-primary">
                â–¶ï¸ Continuer devinette {{ user.userprofile_2025.currentDevinette }}
            </a>
        {% endif %}
        
        <a href="{% url 'avent2025:classement' %}" class="hero-btn hero-btn-secondary">
            ğŸ† Voir le classement
        </a>
        
        {% if user.userprofile_2025.is_family %}
        <a href="{% url 'avent2025:leaderboard' %}?filter=family" class="hero-btn hero-btn-family">
            ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Classement Famille
        </a>
        {% endif %}
    </div>
    
    <!-- Progression visuelle -->
    <div class="hero-progress">
        <div class="progress-columns">
            <!-- Colonne Ã‰nigmes -->
            <div class="progress-column">
                <p class="progress-title">ğŸ§© Ã‰nigmes principales</p>
                <div class="progress-icons">
                    {% for i in "12345678" %}
                        {% with enigma_num=forloop.counter %}
                            {% if enigma_num <= user.userprofile_2025.currentEnigma and user.userprofile_2025.currentEnigma > 0 %}
                                <a href="{% url 'avent2025:display_enigme_id' enigma_num %}" class="progress-icon-link {% if enigma_num < user.userprofile_2025.currentEnigma %}completed{% elif enigma_num == user.userprofile_2025.currentEnigma %}current{% endif %}" title="Ã‰nigme {{ enigma_num }}{% if enigma_num < user.userprofile_2025.currentEnigma %} - RÃ©solue - Cliquez pour revoir{% elif enigma_num == user.userprofile_2025.currentEnigma %} - En cours - Cliquez pour continuer{% endif %}">
                                    <span class="progress-icon">{% if enigma_num < user.userprofile_2025.currentEnigma %}âœ¨{% else %}ğŸ”¥{% endif %}</span>
                                </a>
                            {% else %}
                                <span class="progress-icon locked" title="Ã‰nigme {{ enigma_num }} - BloquÃ©e">ğŸ”’</span>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </div>
                <div class="progress-bar-mini">
                    <div class="progress-bar-fill-mini" style="width: {{ pourcentage }}%"></div>
                </div>
                <p class="progress-label">
                    {% if user.userprofile_2025.currentEnigma == 0 %}
                        PrÃªt Ã  commencer ?
                    {% elif user.userprofile_2025.currentEnigma > 8 %}
                        ğŸ‰ Toutes rÃ©solues !
                    {% else %}
                        {{ enigmes_resolues }}/{{ total_enigmes }} rÃ©solues
                    {% endif %}
                </p>
            </div>
            
            <!-- Colonne Devinettes -->
            <div class="progress-column">
                <p class="progress-title devinette-title">ğŸ­ Devinettes quotidiennes</p>
                <div class="progress-icons devinette-icons">
                    {% for i in "123456789012345678901234" %}
                        {% with devinette_num=forloop.counter current_dev=user.userprofile_2025.currentDevinette %}
                            {% if current_dev > 0 and devinette_num < current_dev %}
                                <a href="{% url 'avent2025:display_devinette_id' devinette_num %}" class="progress-icon-link progress-icon-small completed" title="Devinette {{ devinette_num }} - RÃ©solue - Cliquez pour revoir">
                                    <span class="progress-icon progress-icon-small">âœ¨</span>
                                </a>
                            {% elif current_dev > 0 and devinette_num == current_dev %}
                                <a href="{% url 'avent2025:display_devinette_id' devinette_num %}" class="progress-icon-link progress-icon-small current" title="Devinette {{ devinette_num }} - En cours - Cliquez pour continuer">
                                    <span class="progress-icon progress-icon-small">ğŸ”¥</span>
                                </a>
                            {% else %}
                                <span class="progress-icon progress-icon-small locked" title="Devinette {{ devinette_num }} - BloquÃ©e">ğŸ”’</span>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                </div>
                <div class="progress-bar-mini">
                    <div class="progress-bar-fill-mini devinette-bar" style="width: {% if user.userprofile_2025.currentDevinette == 0 %}0{% else %}{% widthratio user.userprofile_2025.currentDevinette|add:"-1" 24 100 %}{% endif %}%"></div>
                </div>
                <p class="progress-label">
                    {% if user.userprofile_2025.currentDevinette == 0 %}
                        24 devinettes Ã  dÃ©couvrir
                    {% elif user.userprofile_2025.currentDevinette > 24 %}
                        ğŸ‰ Toutes rÃ©solues !
                    {% else %}
                        {% with devinettes_resolues=user.userprofile_2025.currentDevinette|add:"-1" %}
                            {{ devinettes_resolues }}/24 rÃ©solues
                        {% endwith %}
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
</section>

<!-- Section de l'histoire (si vous voulez en ajouter une) -->
<section class="story-section">
    <h2>âœ¨ L'aventure de 2025</h2>
    <div class="story-content">
        <p>
            Cette annÃ©e, le calendrier de l'Avent vous rÃ©serve une sÃ©rie d'Ã©nigmes captivantes 
            et de dÃ©fis intellectuels qui mettront Ã  l'Ã©preuve votre logique, votre crÃ©ativitÃ© 
            et votre perspicacitÃ©.
        </p>
        <div class="story-highlight">
            <p>
                ğŸ’¡ <strong>Nouvelle formule 2025 :</strong> Des Ã©nigmes plus variÃ©es, 
                un systÃ¨me de points amÃ©liorÃ©, et des surprises tout au long du mois de dÃ©cembre !
            </p>
        </div>
        <p>
            Chaque Ã©nigme vous rapproche un peu plus du sommet du classement. 
            RÃ©flÃ©chissez bien, utilisez les indices avec parcimonie, et que le meilleur gagne !
        </p>
    </div>
</section>

<!-- Section Comment Ã§a marche -->
<section class="features-section">
    <h2>ğŸ¯ Comment Ã§a marche ?</h2>
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">ğŸ„</div>
            <h3>Une aventure parsemÃ©e d'Ã©nigmes</h3>
            <p>8 Ã©nigmes principales et 24 devinettes quotidiennes vous attendent. RÃ©solvez-les pour progresser dans le calendrier et accumuler des points !</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">ğŸ’¡</div>
            <h3>SystÃ¨me d'indices intelligent</h3>
            <p>BloquÃ© sur une Ã©nigme ? Utilisez les indices disponibles ! Attention, chaque indice a un coÃ»t en points (1-3 pts selon son utilitÃ©).</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">ğŸ†</div>
            <h3>Classement en temps rÃ©el</h3>
            <p>Suivez votre progression et comparez-vous aux autres participants. Montez dans le classement en rÃ©solvant les dÃ©fis avec le moins d'erreurs possible !</p>
        </div>
    </div>
</section>

<!-- RÃ¨gles et systÃ¨me de points -->
<section class="rules-section">
    <div class="rules-header">
        <h2>ğŸ“œ RÃ¨gles du jeu et systÃ¨me de points</h2>
        <p>Comprendre comment gagner des points et progresser dans le calendrier</p>
    </div>
    
    <div class="rules-grid">
        <div class="rule-card">
            <div class="rule-icon">ğŸ§©</div>
            <h3>Ã‰nigmes principales</h3>
            <div class="rule-details">
                <p><strong>8 Ã©nigmes</strong> Ã  rÃ©soudre au total</p>
                <p class="points-info">ğŸ’° <strong>{{ score_config.points_enigme_resolue }} points</strong> par Ã©nigme rÃ©solue</p>
                <p class="penalty-info">âŒ <strong>-{{ score_config.malus_erreur_enigme }} points</strong> par mauvaise rÃ©ponse</p>
                <p class="hint-info">ğŸ’¡ Les indices coÃ»tent <strong>1 Ã  3 points</strong> selon leur utilitÃ©</p>
            </div>
        </div>
        
        <div class="rule-card">
            <div class="rule-icon">ğŸ­</div>
            <h3>Devinettes quotidiennes</h3>
            <div class="rule-details">
                <p><strong>24 devinettes</strong> rapides et amusantes</p>
                <p class="points-info">ğŸ’° <strong>{{ score_config.points_devinette_resolue }} points</strong> par devinette rÃ©solue</p>
                <p class="penalty-info">âŒ <strong>-{{ score_config.malus_erreur_devinette }} points</strong> par mauvaise rÃ©ponse</p>
                <p class="hint-info">ğŸ’¡ Les indices coÃ»tent <strong>3 points</strong></p>
            </div>
        </div>
        
        <div class="rule-card rule-card-highlight">
            <div class="rule-icon">ğŸ†</div>
            <h3>Calcul du score total</h3>
            <div class="rule-details">
                <p><strong>Score = Points gagnÃ©s - PÃ©nalitÃ©s</strong></p>
                <ul class="score-breakdown">
                    <li>âœ… Ã‰nigmes rÃ©solues Ã— {{ score_config.points_enigme_resolue }} pts</li>
                    <li>âœ… Devinettes rÃ©solues Ã— {{ score_config.points_devinette_resolue }} pts</li>
                    <li>â– Erreurs Ã©nigmes Ã— {{ score_config.malus_erreur_enigme }} pts</li>
                    <li>â– Erreurs devinettes Ã— {{ score_config.malus_erreur_devinette }} pts</li>
                    <li>â– Indices utilisÃ©s (1-3 pts chacun)</li>
                </ul>
                <p class="max-score">ğŸ¯ <strong>Score maximum :</strong> {{ max_score }} points (8Ã—{{ score_config.points_enigme_resolue }} + 24Ã—{{ score_config.points_devinette_resolue }})</p>
            </div>
        </div>
        
    </div>
    
    <div class="rules-tips">
        <h3>ğŸ’­ Conseils stratÃ©giques</h3>
        <div class="tips-grid">
            <div class="tip-item">
                <span class="tip-emoji">ğŸ¯</span>
                <p>RÃ©flÃ©chissez bien avant de rÃ©pondre pour Ã©viter les pÃ©nalitÃ©s</p>
            </div>
            <div class="tip-item">
                <span class="tip-emoji">ğŸ’ª</span>
                <p>Tentez de rÃ©soudre sans indices pour un score optimal</p>
            </div>
            <div class="tip-item">
                <span class="tip-emoji">ğŸ“ˆ</span>
                <p>Consultez rÃ©guliÃ¨rement le classement pour suivre votre progression</p>
            </div>
            <div class="tip-item">
                <span class="tip-emoji">ğŸ”¥</span>
                <p>Les Ã©nigmes prÃ©cÃ©dentes restent accessibles pour rÃ©vision</p>
            </div>
        </div>
    </div>
</section>

{% else %}

<!-- Version non connectÃ©e -->
<section class="hero-section">
    <h1>ğŸ„ Calendrier de l'Avent 2025</h1>
    <p>Participez Ã  notre calendrier de l'Avent interactif et testez vos capacitÃ©s de rÃ©solution d'Ã©nigmes !</p>
    <div class="hero-cta">
        <a href="{% url 'login' %}" class="hero-btn hero-btn-primary">
            ğŸ” Se connecter
        </a>
        <a href="{% url 'signup' %}" class="hero-btn hero-btn-secondary">
            âœ¨ CrÃ©er un compte
        </a>
    </div>
</section>

<!-- Section Comment Ã§a marche (pour non connectÃ©s) -->
<section class="features-section">
    <h2>ğŸ¯ Comment Ã§a marche ?</h2>
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">ğŸ„</div>
            <h3>Une aventure parsemÃ©e d'Ã©nigmes</h3>
            <p>8 Ã©nigmes principales et 24 devinettes quotidiennes vous attendent. RÃ©solvez-les pour progresser dans le calendrier et accumuler des points !</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">ğŸ’¡</div>
            <h3>SystÃ¨me d'indices intelligent</h3>
            <p>BloquÃ© sur une Ã©nigme ? Utilisez les indices disponibles ! Attention, chaque indice a un coÃ»t en points (1-3 pts selon son utilitÃ©).</p>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">ğŸ†</div>
            <h3>Classement en temps rÃ©el</h3>
            <p>Suivez votre progression et comparez-vous aux autres participants. Montez dans le classement en rÃ©solvant les dÃ©fis avec le moins d'erreurs possible !</p>
        </div>
    </div>
</section>

<!-- RÃ¨gles pour non connectÃ©s -->
<section class="rules-section">
    <div class="rules-header">
        <h2>ğŸ“œ RÃ¨gles du jeu et systÃ¨me de points</h2>
        <p>Comprendre comment gagner des points et progresser dans le calendrier</p>
    </div>
    
    <div class="rules-grid">
        <div class="rule-card">
            <div class="rule-icon">ğŸ§©</div>
            <h3>Ã‰nigmes principales</h3>
            <div class="rule-details">
                <p><strong>8 Ã©nigmes</strong> Ã  rÃ©soudre au total</p>
                <p class="points-info">ğŸ’° <strong>{{ score_config.points_enigme_resolue }} points</strong> par Ã©nigme rÃ©solue</p>
                <p class="penalty-info">âŒ <strong>-{{ score_config.malus_erreur_enigme }} points</strong> par mauvaise rÃ©ponse</p>
                <p class="hint-info">ğŸ’¡ Les indices coÃ»tent <strong>1 Ã  3 points</strong> selon leur utilitÃ©</p>
            </div>
        </div>
        
        <div class="rule-card">
            <div class="rule-icon">ğŸ­</div>
            <h3>Devinettes quotidiennes</h3>
            <div class="rule-details">
                <p><strong>24 devinettes</strong> rapides et amusantes</p>
                <p class="points-info">ğŸ’° <strong>{{ score_config.points_devinette_resolue }} points</strong> par devinette rÃ©solue</p>
                <p class="penalty-info">âŒ <strong>-{{ score_config.malus_erreur_devinette }} points</strong> par mauvaise rÃ©ponse</p>
                <p class="hint-info">ğŸ’¡ Les indices coÃ»tent <strong>3 points</strong></p>
            </div>
        </div>
        
        <div class="rule-card rule-card-highlight">
            <div class="rule-icon">ğŸ†</div>
            <h3>Calcul du score total</h3>
            <div class="rule-details">
                <p><strong>Score = Points gagnÃ©s - PÃ©nalitÃ©s</strong></p>
                <ul class="score-breakdown">
                    <li>âœ… Ã‰nigmes rÃ©solues Ã— {{ score_config.points_enigme_resolue }} pts</li>
                    <li>âœ… Devinettes rÃ©solues Ã— {{ score_config.points_devinette_resolue }} pts</li>
                    <li>â– Erreurs Ã©nigmes Ã— {{ score_config.malus_erreur_enigme }} pts</li>
                    <li>â– Erreurs devinettes Ã— {{ score_config.malus_erreur_devinette }} pts</li>
                    <li>â– Indices utilisÃ©s (1-3 pts chacun)</li>
                </ul>
                <p class="max-score">ğŸ¯ <strong>Score maximum :</strong> {{ max_score }} points (8Ã—{{ score_config.points_enigme_resolue }} + 24Ã—{{ score_config.points_devinette_resolue }})</p>
            </div>
        </div>
</section>

{% endif %}

<script>
    // Compte Ã  rebours jusqu'au 1er dÃ©cembre 2025 Ã  00h01
    function initCountdown() {
        const countdownContainer = document.getElementById('countdown-container');
        const targetDate = new Date('2025-12-01T00:01:00').getTime();
        
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = targetDate - now;
            
            // Si la date est passÃ©e, masquer le compte Ã  rebours
            if (distance < 0) {
                if (countdownContainer) {
                    countdownContainer.style.display = 'none';
                }
                return;
            }
            
            // Afficher le compte Ã  rebours
            if (countdownContainer) {
                countdownContainer.style.display = 'block';
            }
            
            // Calculs
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            // Mise Ã  jour de l'affichage avec padding zeros
            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');
            
            if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
            if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
            if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
            if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
        }
        
        // Mise Ã  jour initiale
        updateCountdown();
        
        // Mise Ã  jour toutes les secondes
        const intervalId = setInterval(updateCountdown, 1000);
        
        // Nettoyer l'intervalle quand on quitte la page
        window.addEventListener('beforeunload', () => {
            clearInterval(intervalId);
        });
    }
    
    // DÃ©marrer le compte Ã  rebours quand la page est chargÃ©e
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initCountdown);
    } else {
        initCountdown();
    }
</script>
{% endblock %}
